@model ProgramWeb.Models.ViewModel.UserProjectsViewModel


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<div class="container hideMe">
    <h2>My projects</h2>
    <div class="panel-group">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <a data-toggle="collapse" href="#collapse1">My projects</a>
                </h3>
            </div>
            <div id="collapse1" class="panel-collapse collapse">
                <ul class="list-group">
                    @foreach (var project in Model.ProjectList)
                    {
<<<<<<< HEAD
                        <li class="list-group-item"><a data-toggle="collapse" href="#@project.Id">@project.Name</a></li>
                        <li id="@project.Id" class="panel-collapse collapse">
=======
                        <li class="list-group-item selectedProject" data-id="@project.Id" onclick="projectSelection(this)"><a data-toggle="collapse" href="#@project.Id">@project.Name</a></li>
                        <div id="@project.Id" class="panel-collapse collapse">
>>>>>>> 7356f41dcab86bf90bf59cd62ab2e2b3bc5f120f
                            <ul>
                                @foreach (var file in project.ProjectFiles)
                                {
                                    <li class="list-group-item selected" data-id="@file.ID" onclick="setEditorContent('@file.ID', this)"><a href="#@file.ID">@file.Name</a></li>
                                }
                            </ul>
                        </li>
                    }
                </ul>


            </div>

        </div>
    </div>
</div>

<div> <input type="button" value="Funi Save" class="btn btn-success" onclick="saveButton()"/></div>

<script>
    function saveButton() {
        var fileID = $(".selected").attr('data-id');
        var content = editor.getSession().getValue();
        alert(fileID);
        SaveFileAjax(fileID, content);  
    };

    function projectSelection(currentObject) {
        setSelectedProject(currentObject);
        var projectId = $(".selectedProject").attr('data-id');
        $('#hiddenProjectID').attr('value', projectId);
        alert(projectId);
    }

    function setEditorContent(value, currentObject) {
        setSelected(currentObject);
        GetFileAjax(value).done(function (value) {
            editor.getSession().setValue(value)
        });
    };

    function GetFileAjax(value) {
        return $.ajax({
            url: '@Url.Action("GetFileForEditor", "Project")',
            data: { id: value },
            type: "POST"
        });
    };

    function setSelected(currentObject) {
        $(".selected").removeClass("selected");
        $(currentObject).addClass("selected");
    };

    function setSelectedProject(currentObject) {
        $(".selectedProject").removeClass("selectedProject");
        $(currentObject).addClass("selectedProject");
    };

    function SaveFileAjax(value, content) {
        $.ajax({
            url: '@Url.Action("SaveFileForEditor", "Project")',
            data: {
                id: value,
                content: content
            },
            type: "POST"
        });
    };

    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
        acc[i].onclick = function () {
            /* Toggle between adding and removing the "active" class,
            to highlight the button that controls the panel */
            this.classList.toggle("active");

            /* Toggle between hiding and showing the active panel */
            var panel = this.nextElementSibling;
            if (panel.style.display === "block") {
                panel.style.display = "none";
            } else {
                panel.style.display = "block";
            }
        }
    };

</script>
<!-- Sidebar -->
